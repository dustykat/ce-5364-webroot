
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Site Mapping Tools &#8212; Groundwater Transport Phenomena</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/03site.mapping.tools/site.mapping.tools';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6. Site Characterization" href="../03site.characterization/site.characterization.html" />
    <link rel="prev" title="3. Fundamentals (Practice)" href="../01fundamentals/01fundamentals.practice.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/gwtransport.png" class="logo__image only-light" alt="Groundwater Transport Phenomena - Home"/>
    <script>document.write(`<img src="../../_static/gwtransport.png" class="logo__image only-dark" alt="Groundwater Transport Phenomena - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00syllabus/ce5364-syllabus-2025-3.html">0. Syllabus (Fall 2025)</a></li>

<li class="toctree-l1"><a class="reference internal" href="../00introduction/00introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01fundamentals/01fundamentals.science.html">2. Fundamentals I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01fundamentals/01fundamentals.practice.html">3. Fundamentals (Practice)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">5. Site Mapping Tools</a></li>





<li class="toctree-l1"><a class="reference internal" href="../03site.characterization/site.characterization.html">6. Site Characterization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04physical.transport/physical.transport.html">7. Physical Transport</a></li>



<li class="toctree-l1"><a class="reference internal" href="../04physical.transport/modeling.advection.html">8. Modeling Advection</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapters/03site.mapping.tools/site.mapping.tools.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/03site.mapping.tools/site.mapping.tools.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>5. Site Mapping Tools</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">5. Site Mapping Tools</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#readings">Readings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#video-s">Video(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#approach">Approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-will-build">What we will build</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-expectations">Data expectations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#roadmap">Roadmap</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#contour-plots">5.1 Contour Plots</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#wireframe-plots">5.2 Wireframe Plots</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#surface-plots">5.3 Surface Plots</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#block-models-from-interval-data-experimental">5.4 Block models from interval data (Experimental)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#axial-slices-through-3d-block-models">5.5 Axial slices through 3D block models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-s">Exercise(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#section-end">Section End</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="site-mapping-tools">
<h1>5. Site Mapping Tools<a class="headerlink" href="#site-mapping-tools" title="Link to this heading">#</a></h1>
<p>This chapter—<em>site.mapping.tools</em>—builds a small, reusable toolkit for various kinds of mapping.</p>
<div class="admonition-course-website admonition">
<p class="admonition-title">Course Website</p>
<p><a class="reference external" href="http://54.243.252.9/ce-5364-webroot">CE 5364 Course Webroot</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%html</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span><span class="w"> </span><span class="nt">table</span><span class="w"> </span><span class="p">{</span><span class="k">margin-left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cp">!important</span><span class="p">;}</span><span class="w"> </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style> table {margin-left: 0 !important;} </style>
</div></div>
</div>
<section id="readings">
<h2>Readings<a class="headerlink" href="#readings" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#link"><span class="xref myst">Text</span></a></p></li>
<li><p><a class="reference external" href="https://people.wou.edu/~taylors/g302/Contouring_Techniques.pdf">https://people.wou.edu/~taylors/g302/Contouring_Techniques.pdf</a></p></li>
</ol>
</section>
<section id="video-s">
<h2>Video(s)<a class="headerlink" href="#video-s" title="Link to this heading">#</a></h2>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>Mapping is a foundational step in understanding groundwater transport because transport is controlled not only by subsurface properties, but also by how those properties vary spatially. A well-prepared map transforms scattered data points—such as well logs, water table elevations, contaminant concentrations, or soil classifications—into a coherent spatial framework.</p>
<p>In groundwater transport studies, mapping serves several critical purposes:</p>
<ul class="simple">
<li><p>Defining boundaries and extents – Accurate maps delineate watershed limits, recharge zones, aquifer boundaries, and areas of interest, ensuring that the domain for modeling or analysis is well-defined.</p></li>
<li><p>Visualizing gradients and flow directions – Contour maps of hydraulic head, for example, make it immediately apparent where groundwater is flowing and where potential stagnation or discharge zones occur.</p></li>
<li><p>Linking data to location – Transport parameters such as hydraulic conductivity, porosity, dispersivity, or sorption capacity often vary spatially. Mapping these variations allows for realistic spatial discretization in numerical or analytical models.</p></li>
<li><p>Identifying sources and receptors – Maps help pinpoint contaminant sources (e.g., leaking storage tanks) and potential receptors (e.g., wells, streams, wetlands) so transport paths can be evaluated.</p></li>
<li><p>Communicating findings – Visual maps are far more effective than tables or text for conveying complex spatial relationships to decision makers, stakeholders, and the public.</p></li>
</ul>
<p>In short, mapping is not just a cartographic exercise—it is a way of integrating and communicating the spatial framework that underlies every calculation in groundwater transport analysis. Without a sound mapping base, even sophisticated transport models risk being misapplied or misinterpreted.  The figure below diagrams the relationship of mapping to groundwater transport phenomenon.</p>
<p><img alt="" src="../../_images/mapping.workflow.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GIS platforms provide powerful built-in mapping capabilities, but they are designed for general-purpose spatial analysis rather than the highly customized needs of a groundwater transport study. Site-specific work—such as integrating nonstandard monitoring data formats, applying custom interpolation or statistical routines, or embedding mapping directly into a modeling workflow—may require flexibility beyond what a GIS interface allows. External tools, such as Python scripts, command-line utilities, or domain-specific modeling packages, let us automate repetitive steps, ensure reproducibility, and tailor the mapping process to the unique geometry, data constraints, and analytical requirements of a site.</p>
</div>
<p>This chapter focues on two complementary mapping threads to support a groundwater transport study:</p>
<ol class="arabic simple">
<li><p><strong>2D surface visualization from XYZ data.</strong> Using tabular files (structured XYZ) where Z can be elevation, concentration, temperature, etc., we produce:</p></li>
</ol>
<ul class="simple">
<li><p>Contour maps (line and filled)</p></li>
<li><p>Wireframe surfaces</p></li>
<li><p>Filled 3D surfaces colored by Z
<br>These visualizations support interpretation on their own and also serve as intermediate steps when constructing flow fields for particle-tracking style models. The contour map tools can also generate output files (.PNG or .PDF) with a transparent background, allowing them to be overlaid directly onto GIS maps. To align these overlays, you only need the lower-left and upper-right corner coordinates to match the GIS coordinate reference system (CRS)—once aligned, the image can be dropped seamlessly into the GIS environment.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p><strong>3D conceptual block models of the subsurface.</strong></p></li>
</ol>
<ul class="simple">
<li><p>From datasets of the form x, y, z_low, z_high, attribute (e.g., clay/silt/sand), we render colored prisms to visualize lithologic intervals and the “shape” of the subsurface.</p></li>
<li><p>Optional tools allow these volumes to be sliced—by profile, layer, or custom plane—to highlight specific features and support interpretation.</p></li>
</ul>
<section id="approach">
<h3>Approach<a class="headerlink" href="#approach" title="Link to this heading">#</a></h3>
<p>We deliberately stay within the open-source Python stack (ENGR-1330 methods) and standard plotting tools. The goal is to demonstrate practical ways to produce different types of maps while providing a reliable, working code base you can adapt for your own projects. You’ll be responsible for extending and modifying these examples to fit your specific site and objectives—remember, AI assistants are well-suited for helping you make such modifications, and you can always return to this code base if something breaks.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The tools herein use:</p>
<ul class="simple">
<li><p>Core: NumPy, Pandas, SciPy, Matplotlib (including matplotlib.tri)</p></li>
<li><p>Optional (for richer 3D slicing and interaction): PyVista (VTK)</p></li>
</ul>
<p>If you want to use the 3D slicing and interactive features, you’ll need to install <code class="docutils literal notranslate"><span class="pre">pyvista</span></code> in your Python environment. In the examples shown here, the code runs on a headless server (no desktop GUI), so some interactive PyVista features are unavailable. If you run the scripts on your own computer with a desktop environment, you may have access to richer interactive capabilities.</p>
</div>
<p>Examples use both real digitized datasets and synthetic datasets. The goal is portability: you create a structured input file, choose plotting parameters, and—<em>voilà</em>—you have publication-quality figures. Because everything is open source, you can tailor the code to your project rather than forcing your project to fit a tool.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Yes, we are effectively building lightweight “specialized software.” The difference is intent and control: by investing time in a clear learning curve and data preparation, we avoid licensing limits and can adapt the tools to your needs.</p>
</div>
</section>
<section id="what-we-will-build">
<h3>What we will build<a class="headerlink" href="#what-we-will-build" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>A set of drop-in plotting functions with consistent signatures:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_contours_gridded_from_xyz(...)</span></code> and <code class="docutils literal notranslate"><span class="pre">plot_contours_triangulated_from_xyz(...)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_wireframe_from_xyz(...)</span></code> and <code class="docutils literal notranslate"><span class="pre">plot_triangulated_surface_from_xyz(...)</span></code></p></li>
<li><p>Options for filled surfaces, vertical exaggeration, consistent color scales, basemap underlays, and safe interpolation at arbitrary query points.</p></li>
</ul>
</li>
<li><p>A simple 3D block-model renderer (colored prisms) from z_low / z_high / attribute tables, with a pathway to PyVista for slicing and interactive inspection.</p></li>
</ul>
</section>
<section id="data-expectations">
<h3>Data expectations<a class="headerlink" href="#data-expectations" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>2D surfaces: CSV/TSV with columns like X-Easting, Y-Northing, Z-Elevation (names can be adapted).</p></li>
<li><p>3D blocks: x, y, z_low, z_high, attribute (attribute is a categorical string, e.g., “sand”).</p></li>
<li><p>Units and coordinate reference should be stated (e.g., feet vs meters), and the chapter examples assume a planar XY coordinate system.</p></li>
</ul>
</section>
<section id="roadmap">
<h3>Roadmap<a class="headerlink" href="#roadmap" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Contours from scattered XYZ (gridded and triangulated), including filled plan-view projections at a constant Z.</p></li>
<li><p>3D wireframe and filled surfaces with user-controlled vertical exaggeration.</p></li>
<li><p>Conceptual 3D block models from interval data, then move to PyVista for slicing and interactive exploration.</p></li>
</ol>
<p>Up next: we start with 2D contouring and plan-view projections, then lift the surface into 3D.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="contour-plots">
<h1>5.1 Contour Plots<a class="headerlink" href="#contour-plots" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Plots with gridding.  Explain concept of gridding.  Common issues where gridding fails</p></li>
<li><p>Plots using Delaunay triangulation.  Value of triangulation.  Common issues where trinagulation fails</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_contours_gridded_from_xyz.py</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Plan-view contouring from scattered XYZ by gridding + interpolation.</span>
<span class="c1">#   Supports line or filled contours, optional basemap, and overlay of</span>
<span class="c1">#   original points. Designed for JupyterBook lessons.</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>

<span class="k">def</span> <span class="nf">plot_contours_gridded_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="c1"># levels: pass explicit list, or define start/stop/step, or None to auto</span>
    <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">level_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span>                <span class="c1"># &#39;linear&#39;|&#39;cubic&#39;|&#39;nearest&#39;</span>
    <span class="n">fillna</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>              <span class="c1"># None|&#39;nearest&#39;</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                  <span class="c1"># False: contour lines; True: filled</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">basemap_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>             <span class="c1"># e.g., &quot;SomewhereUSABaseMap.png&quot;</span>
    <span class="n">basemap_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>           <span class="c1"># (xmin, xmax, ymin, ymax) if using basemap</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot plan-view contours by first interpolating scattered XYZ onto a grid.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Path to text file with columns &#39;X-Easting&#39;, &#39;Y-Northing&#39;, &#39;Z-Elevation&#39;.</span>
<span class="sd">    sep : str, optional</span>
<span class="sd">        Column delimiter (default tab).</span>
<span class="sd">    levels : sequence of float, optional</span>
<span class="sd">        Explicit contour levels. If None, will use (level_start, level_stop, level_step)</span>
<span class="sd">        if provided, else auto-generate 10 levels from data range.</span>
<span class="sd">    level_start, level_stop, level_step : float, optional</span>
<span class="sd">        Convenience to build levels = np.arange(start, stop+step, step).</span>
<span class="sd">    nx, ny : int</span>
<span class="sd">        Grid resolution in X and Y.</span>
<span class="sd">    method : {&#39;linear&#39;,&#39;cubic&#39;,&#39;nearest&#39;}</span>
<span class="sd">        griddata interpolation method.</span>
<span class="sd">    fillna : {None,&#39;nearest&#39;}</span>
<span class="sd">        Fill NaNs after interpolation (useful near convex hull edges).</span>
<span class="sd">    filled : bool</span>
<span class="sd">        If True, use filled contours (contourf); else contour lines.</span>
<span class="sd">    cmap : str</span>
<span class="sd">        Matplotlib colormap for filled contours.</span>
<span class="sd">    show_points : bool</span>
<span class="sd">        Overlay original survey points.</span>
<span class="sd">    point_size : float</span>
<span class="sd">        Marker size for original points.</span>
<span class="sd">    point_color : str</span>
<span class="sd">        Color for original points.</span>
<span class="sd">    basemap_path : str or None</span>
<span class="sd">        Optional raster image path to show under contours.</span>
<span class="sd">    basemap_extent : tuple or None</span>
<span class="sd">        Extent (xmin, xmax, ymin, ymax) for basemap.</span>
<span class="sd">    title : str or None</span>
<span class="sd">        Plot title; defaults to &#39;Contour Plot from &lt;filename&gt;&#39;.</span>
<span class="sd">    ax : matplotlib Axes or None</span>
<span class="sd">        Axes to draw into. If None, a new figure/axes is created.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Xg, Yg, Zg, cs, ax : ndarray, ndarray, ndarray, QuadContourSet, Axes</span>
<span class="sd">        Gridded coordinates/values, the contour set, and the axes.</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load data ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

    <span class="c1"># --- Build grid ---</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ny</span><span class="p">)</span>
    <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

    <span class="c1"># --- Interpolate to grid ---</span>
    <span class="n">Zg</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fillna</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">Zg</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

    <span class="c1"># --- Levels logic ---</span>
    <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">level_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">level_stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">level_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">level_start</span><span class="p">,</span> <span class="n">level_stop</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">level_step</span><span class="p">,</span> <span class="n">level_step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Zg</span><span class="p">);</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Zg</span><span class="p">)</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">))</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="c1"># Optional basemap</span>
    <span class="k">if</span> <span class="n">basemap_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">basemap_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">basemap_extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">basemap_extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">basemap_extent</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>

    <span class="c1"># Contours</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Survey Points&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span> <span class="ow">or</span> <span class="sa">f</span><span class="s1">&#39;Contour Plot from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate (Easting)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate (Northing)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gridded, filled contours with explicit levels</span>
<span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_contours_gridded_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span>
    <span class="n">level_start</span><span class="o">=</span><span class="mi">81</span><span class="p">,</span> <span class="n">level_stop</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span> <span class="n">level_step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/43feca8c78ca833affa8e246da365007727f942481e466fc91a67dd756335365.png" src="../../_images/43feca8c78ca833affa8e246da365007727f942481e466fc91a67dd756335365.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_contours_triangulated_from_xyz.py</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Plan-view contouring from scattered XYZ using Delaunay triangulation,</span>
<span class="c1">#   with safe interpolation at arbitrary (x,y) query points. Outside-hull</span>
<span class="c1">#   behavior is configurable (nan or nearest-neighbor fallback).</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">mtri</span>
<span class="kn">from</span> <span class="nn">matplotlib.tri</span> <span class="kn">import</span> <span class="n">LinearTriInterpolator</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">cKDTree</span>

<span class="k">def</span> <span class="nf">plot_contours_triangulated_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">level_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                  <span class="c1"># False: tricontour; True: tricontourf</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">query_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>             <span class="c1"># e.g., [(400,200), (-350,-30)]</span>
    <span class="n">annotate_queries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">on_outside</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>          <span class="c1"># &#39;nearest&#39; | &#39;nan&#39; | &#39;ignore&#39;</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot plan-view contours from scattered XYZ using triangulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ...</span>
<span class="sd">    query_points : list[(float,float)] or None</span>
<span class="sd">        XY locations to interpolate Z. Safe outside-hull handling.</span>
<span class="sd">    on_outside : {&#39;nearest&#39;,&#39;nan&#39;,&#39;ignore&#39;}</span>
<span class="sd">        Behavior when a query point lies outside the triangulation hull</span>
<span class="sd">        or in a masked triangle:</span>
<span class="sd">          - &#39;nearest&#39;: use nearest original sample&#39;s Z</span>
<span class="sd">          - &#39;nan&#39;: return np.nan</span>
<span class="sd">          - &#39;ignore&#39;: attempt float() conversion (may warn)</span>
<span class="sd">    ...</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    triang, cs, interpolator, ax : Triangulation, ContourSet, LinearTriInterpolator or None, Axes</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load data ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># --- Triangulate ---</span>
    <span class="n">triang</span> <span class="o">=</span> <span class="n">mtri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># --- Levels logic ---</span>
    <span class="k">if</span> <span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">level_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">level_stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">level_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">level_start</span><span class="p">,</span> <span class="n">level_stop</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">level_step</span><span class="p">,</span> <span class="n">level_step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">);</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># --- Plot setup ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">))</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># --- Optional interpolation queries (safe) ---</span>
    <span class="n">interpolator</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">query_points</span><span class="p">:</span>
        <span class="n">interpolator</span> <span class="o">=</span> <span class="n">LinearTriInterpolator</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">trifinder</span> <span class="o">=</span> <span class="n">triang</span><span class="o">.</span><span class="n">get_trifinder</span><span class="p">()</span>
        <span class="c1"># NN fallback prep (only used if on_outside == &#39;nearest&#39;)</span>
        <span class="n">kdtree</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span> <span class="k">if</span> <span class="n">on_outside</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">)</span> <span class="ow">in</span> <span class="n">query_points</span><span class="p">:</span>
            <span class="n">z_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="c1"># Check which triangle this point falls into (-1 =&gt; outside)</span>
            <span class="n">tri_idx</span> <span class="o">=</span> <span class="n">trifinder</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tri_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">z_masked</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">)</span>  <span class="c1"># returns masked array scalar</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">z_masked</span><span class="p">):</span>
                    <span class="c1"># inside triangulation but masked face (rare); treat as outside</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z_masked</span><span class="p">)</span>
            <span class="c1"># If outside or masked, handle per policy</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_val</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">on_outside</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">kdtree</span><span class="o">.</span><span class="n">query</span><span class="p">([</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">z_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">on_outside</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
                    <span class="c1"># original behavior (may warn); try conversion anyway</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">z_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">interpolator</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">z_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;nan&#39;</span>
                    <span class="n">z_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">annotate_queries</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z_val</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="p">(</span><span class="n">qx</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">qy</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Survey Points&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span> <span class="ow">or</span> <span class="sa">f</span><span class="s1">&#39;Contour Plot from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate (Easting)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate (Northing)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">triang</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_contours_triangulated_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">1</span><span class="p">)],</span>
    <span class="n">query_points</span><span class="o">=</span><span class="p">[(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">350</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)],</span>  <span class="c1"># try one outside the hull too</span>
    <span class="n">on_outside</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>   <span class="c1"># or &#39;nan&#39;</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9b57713f4b0689c7ff84ea69d805288422a601ee785f20ce472500c92dd07ab8.png" src="../../_images/9b57713f4b0689c7ff84ea69d805288422a601ee785f20ce472500c92dd07ab8.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;matplotlib.tri._triangulation.Triangulation at 0x7e1cc2762770&gt;,
 &lt;matplotlib.tri._tricontour.TriContourSet at 0x7e1cc27c28c0&gt;,
 &lt;matplotlib.tri._triinterpolate.LinearTriInterpolator at 0x7e1cc27e8e20&gt;,
 &lt;Axes: title={&#39;center&#39;: &#39;Contour Plot from ARS-W1-XYZ.txt&#39;}, xlabel=&#39;X Coordinate (Easting)&#39;, ylabel=&#39;Y Coordinate (Northing)&#39;&gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="c1">#######################################################################</span>
<span class="c1"># Irregular data are interpolated onto a regular grid before plotting #</span>
<span class="c1">#######################################################################</span>
<span class="c1"># === Load Data ===</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span>
<span class="n">my_xyz</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">my_xyz</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">my_xyz</span><span class="p">)</span>

<span class="n">coord_x</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">coord_y</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">coord_z</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">coord_xy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">))</span>

<span class="c1"># === Create Grid ===</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coord_xy</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coord_z</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># === Plotting ===</span>
<span class="n">use_basemap</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># &lt;- Flip to True if you ever want to bring it back</span>

<span class="k">if</span> <span class="n">use_basemap</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.autolayout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;SomewhereUSABaseMap.png&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="k">if</span> <span class="n">use_basemap</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3361</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1458</span><span class="p">])</span>

<span class="c1"># Contours</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Titles and limits</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Contour Plot from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>  <span class="c1"># &lt;- Enforce 1:1 aspect ratio</span>

<span class="c1"># Plot a line segment to represent the weir wall</span>
<span class="c1"># Line segment coordinates</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">485</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">44</span>

<span class="c1"># Draw the line segment</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># Annotate the segment</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Weir Wall&quot;</span><span class="p">,</span>             <span class="c1"># Text label</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span>   <span class="c1"># Point being annotated</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y2</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Label position</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="c1"># Plot a red filled circle at the gage location</span>
<span class="n">x_marker</span> <span class="o">=</span> <span class="o">-</span><span class="mi">390</span>
<span class="n">y_marker</span> <span class="o">=</span> <span class="o">-</span><span class="mi">45</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_marker</span><span class="p">,</span> <span class="n">y_marker</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Annotate the marker</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;Weir Outlet&quot;</span><span class="p">,</span>             <span class="c1"># Text label</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_marker</span><span class="p">,</span> <span class="n">y_marker</span><span class="p">),</span>   <span class="c1"># Point being annotated</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">x_marker</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">y_marker</span> <span class="o">+</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Label position</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">),</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Add scatter plot of original XYZ data</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Survey Data Points&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3d7d9e633b007cbe503b72051b47f107af0adfdaa19735a70702b2b38e8368b2.png" src="../../_images/3d7d9e633b007cbe503b72051b47f107af0adfdaa19735a70702b2b38e8368b2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="c1">#######################################################################</span>
<span class="c1"># Irregular data are interpolated onto a regular grid before plotting #</span>
<span class="c1">#######################################################################</span>
<span class="n">original_points</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># switch to overlay original points</span>

<span class="c1"># === Load Data ===</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span>
<span class="n">my_xyz</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">my_xyz</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">my_xyz</span><span class="p">)</span>

<span class="n">coord_x</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">coord_y</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">coord_z</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">coord_xy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">))</span>

<span class="c1"># === Create Grid ===</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coord_xy</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coord_z</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># === Plotting ===</span>
<span class="n">use_basemap</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># &lt;- Flip to True if you ever want to bring it back</span>

<span class="k">if</span> <span class="n">use_basemap</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.autolayout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;SomewhereUSABaseMap.png&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="k">if</span> <span class="n">use_basemap</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3361</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1458</span><span class="p">])</span>

<span class="c1"># Contours</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Titles and limits</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Contour Plot from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>  <span class="c1"># &lt;- Enforce 1:1 aspect ratio</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>



<span class="k">if</span> <span class="n">original_points</span><span class="p">:</span>
<span class="c1"># Add scatter plot of original XYZ data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Survey Data Points&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/418286a61021084a53236ead45a9653c144194ee42fdd466ca9014e3e33f0667.png" src="../../_images/418286a61021084a53236ead45a9653c144194ee42fdd466ca9014e3e33f0667.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">tri</span>
<span class="kn">from</span> <span class="nn">matplotlib.tri</span> <span class="kn">import</span> <span class="n">LinearTriInterpolator</span>

<span class="n">original_points</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># switch to overlay original points</span>
<span class="n">interpolate_flag</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">filename</span><span class="o">=</span><span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span>
<span class="c1"># === Load Data ===</span>
<span class="n">my_xyz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">coord_x</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">coord_y</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">coord_z</span> <span class="o">=</span> <span class="n">my_xyz</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># === Triangulate for Irregular Grid ===</span>
<span class="n">triang</span> <span class="o">=</span> <span class="n">tri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">)</span>

<span class="c1"># === Optional Base Map Image ===</span>
<span class="c1"># insert code later</span>


<span class="c1"># === Contour Plot via Triangulation ===</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">81</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span> <span class="n">coord_z</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># === Bounding Box Overlay ===</span>
<span class="c1"># insert code later</span>

<span class="c1"># === Interpolator Block (for future particle tracking logic) ===</span>

<span class="k">if</span> <span class="n">interpolate_flag</span><span class="p">:</span>
    <span class="n">interpolator</span> <span class="o">=</span> <span class="n">LinearTriInterpolator</span><span class="p">(</span><span class="n">triang</span><span class="p">,</span> <span class="n">coord_z</span><span class="p">)</span>

    <span class="c1"># Define a test point</span>
    <span class="n">x_query</span> <span class="o">=</span> <span class="mi">400</span>
    <span class="n">y_query</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">z_est</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">x_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolated Z at (</span><span class="si">{</span><span class="n">x_query</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y_query</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">z_est</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>  <span class="c1"># Red dot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">z_est</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">x_query</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">y_query</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># === Final Plot Settings ===</span>

<span class="k">if</span> <span class="n">original_points</span><span class="p">:</span>
<span class="c1"># Add scatter plot of original XYZ data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">coord_x</span><span class="p">,</span> <span class="n">coord_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Survey Data Points&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Contour Plot from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_x</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">coord_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">coord_y</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">)</span>  <span class="c1"># &lt;- Enforce 1:1 aspect ratio</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X - Easting&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y - Northing&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">coord_y</span><span class="p">))</span>
<span class="n">CS</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Interpolated Z at (400.00, 200.00) = nan
</pre></div>
</div>
<img alt="../../_images/cafb19023be93dc395072c36faf6b5a49ff7d0c56a94622bad344ea7b02807ae.png" src="../../_images/cafb19023be93dc395072c36faf6b5a49ff7d0c56a94622bad344ea7b02807ae.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>471.053705
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.tri._tricontour.TriContourSet at 0x7e1cc0cfb730&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="wireframe-plots">
<h1>5.2 Wireframe Plots<a class="headerlink" href="#wireframe-plots" title="Link to this heading">#</a></h1>
<p>A wireframe plot is a three-dimensional representation of a surface where the surface is drawn as a mesh of intersecting lines rather than as a solid, filled object. In contrast, a contour plot flattens the same data into a two-dimensional view, showing lines (contours) of constant value projected onto a horizontal plane. Both originate from the same underlying dataset—typically a set of <span class="math notranslate nohighlight">\(x,y,z\)</span> points—but they convey different perspectives. A contour plot emphasizes the plan view and makes it easy to read values and gradients at specific horizontal positions. A wireframe plot, on the other hand, reveals the form and shape of the surface in three dimensions, allowing the viewer to perceive slopes, peaks, and valleys from an oblique angle.</p>
<p>Wireframe plots can be especially useful in groundwater transport studies when you want to visualize surfaces such as water table elevations, contaminant concentration distributions, or subsurface temperature fields in a way that makes vertical variation obvious. Because they are less visually dense than filled 3D surfaces, wireframes often make it easier to see through the mesh to underlying features or reference grids. They also help highlight spatial relationships—such as how a contaminant plume rides along a sloping water table—that may not be as immediately apparent in a flat contour map. In practice, wireframe and contour plots are complementary: the contour plot provides precise horizontal context, while the wireframe offers a spatial form that can be easier for some audiences to interpret intuitively.</p>
<blockquote>
<div><p>The scripting code is nearly identical to that used for contour plots, but it employs a different rendering engine within <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_wireframe_from_xyz.py</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Utility function to plot a 3D wireframe from an XYZ dataset using</span>
<span class="c1">#   gridding + interpolation. Designed for pedagogical use in </span>
<span class="c1">#   JupyterBooks, teaching site characterization, contouring, and </span>
<span class="c1">#   surface visualization. Supports vertical exaggeration to improve</span>
<span class="c1">#   interpretability when XY ranges greatly exceed Z range.</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa: F401</span>

<span class="k">def</span> <span class="nf">plot_wireframe_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>          <span class="c1"># griddata method: &#39;linear&#39;|&#39;cubic&#39;|&#39;nearest&#39;</span>
    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>           <span class="c1"># how to fill NaNs after primary interp: None|&#39;nearest&#39;</span>
    <span class="n">rstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>       <span class="c1"># &lt;&lt; user control for vertical exaggeration</span>
    <span class="n">view_elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">view_azim</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>        <span class="c1"># overlay original points for QA</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Wireframe (Interpolated Grid)&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span>                   <span class="c1"># optionally pass an existing 3D axes</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D wireframe from an XYZ text file using gridding + interpolation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Xg, Yg, Zg, ax : ndarrays and the Matplotlib 3D axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

    <span class="c1"># --- Grid ---</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ny</span><span class="p">)</span>
    <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

    <span class="c1"># --- Interpolate primary ---</span>
    <span class="n">Zg</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

    <span class="c1"># --- Optional fill of holes (edges/convex hull gaps) ---</span>
    <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">Zg</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="n">rstride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">cstride</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="c1"># Aspect with vertical exaggeration</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="n">vertical_exag</span><span class="p">))</span>

    <span class="c1"># Camera</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">ax</span>

<span class="c1">## Usage example</span>
<span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_wireframe_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>      <span class="c1"># try 10–40 depending on your XY span</span>
    <span class="n">nx</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span>        <span class="c1"># bump resolution if you want smoother wires</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>       <span class="c1"># &#39;linear&#39; is robust; &#39;cubic&#39; is prettier but pickier</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">True</span>       <span class="c1"># overlay raw XYZ to sanity-check interpolation</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/de991a55e9f24a133637a476107ef53ff533d4598618edb12ca661ac101403bd.png" src="../../_images/de991a55e9f24a133637a476107ef53ff533d4598618edb12ca661ac101403bd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_triangulated_surface_from_xyz.py</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Utility function to plot a 3D triangulated surface from an XYZ </span>
<span class="c1">#   dataset using Delaunay triangulation of the scattered points. </span>
<span class="c1">#   Designed for pedagogical use in JupyterBooks, teaching site </span>
<span class="c1">#   characterization and surface visualization. Supports vertical </span>
<span class="c1">#   exaggeration to improve interpretability when XY ranges greatly </span>
<span class="c1">#   exceed Z range.</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">mtri</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa: F401</span>

<span class="k">def</span> <span class="nf">plot_triangulated_surface_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>          <span class="c1"># kept for signature compatibility; not used</span>
    <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>               <span class="c1"># kept for compatibility</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                  <span class="c1"># kept for compatibility</span>
    <span class="n">rstride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># not used in triangulated plotting</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>         <span class="c1"># user control for vertical exaggeration</span>
    <span class="n">view_elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">view_azim</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>          <span class="c1"># overlay original points</span>
    <span class="n">point_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Triangulated Surface (Wireframe Style)&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span>                     <span class="c1"># optionally pass an existing 3D axes</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D triangulated surface from an XYZ text file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Path to the XYZ text file. Must contain &#39;X-Easting&#39;, &#39;Y-Northing&#39;,</span>
<span class="sd">        and &#39;Z-Elevation&#39; columns.</span>
<span class="sd">    sep : str, optional</span>
<span class="sd">        Column delimiter (default: tab &#39;\t&#39;).</span>
<span class="sd">    nx, ny : int, optional</span>
<span class="sd">        Unused, present for compatibility with gridded wireframe function.</span>
<span class="sd">    method : ignored</span>
<span class="sd">        Present for compatibility.</span>
<span class="sd">    fill : ignored</span>
<span class="sd">        Present for compatibility.</span>
<span class="sd">    rstride, cstride : ignored</span>
<span class="sd">        Present for compatibility.</span>
<span class="sd">    linewidth : float, optional</span>
<span class="sd">        Edge line thickness for triangulated surface.</span>
<span class="sd">    edgecolor : str, optional</span>
<span class="sd">        Edge color for triangulated surface.</span>
<span class="sd">    vertical_exag : float, optional</span>
<span class="sd">        Vertical exaggeration factor for aspect ratio.</span>
<span class="sd">    view_elev, view_azim : float, optional</span>
<span class="sd">        Elevation and azimuth angles for the 3D view.</span>
<span class="sd">    show_points : bool, optional</span>
<span class="sd">        If True, plot original XYZ points.</span>
<span class="sd">    point_size : float, optional</span>
<span class="sd">        Size of original points if plotted.</span>
<span class="sd">    point_color : str, optional</span>
<span class="sd">        Color of original points if plotted.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Plot title.</span>
<span class="sd">    ax : matplotlib 3D axes, optional</span>
<span class="sd">        Pass an existing Axes3D to plot into.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tri, ax : matplotlib.tri.Triangulation, Axes3D</span>
<span class="sd">        Triangulation object and axes object.</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    Developed for JupyterBook lesson on site characterization and</span>
<span class="sd">    surface visualization (XYZ → contour, wireframe, and surface plots).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="c1"># --- Triangulation ---</span>
    <span class="n">tri</span> <span class="o">=</span> <span class="n">mtri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Plot as a thin-edged surface, light face shading</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">tri</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                           <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="c1"># Aspect with vertical exaggeration</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="n">vertical_exag</span><span class="p">))</span>

    <span class="c1"># Camera</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tri</span><span class="p">,</span> <span class="n">ax</span>

<span class="n">tri</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_triangulated_surface_from_xyz</span><span class="p">(</span><span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span> <span class="n">vertical_exag</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">show_points</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/12d35c179a5105a8feeed36479862b45a81debc812ab4666c08e0dd063e4414e.png" src="../../_images/12d35c179a5105a8feeed36479862b45a81debc812ab4666c08e0dd063e4414e.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="surface-plots">
<h1>5.3 Surface Plots<a class="headerlink" href="#surface-plots" title="Link to this heading">#</a></h1>
<p>A surface plot is a three-dimensional visualization where the entire surface is rendered as a solid, colored shape rather than as a mesh of lines (wireframe) or a set of projected contour lines. Like contour and wireframe plots, it is generated from a dataset of <span class="math notranslate nohighlight">\(x,y,z\)</span> values, but the surface plot uses continuous shading or color mapping to represent variations in the z dimension. This color shading can be tied to elevation, concentration, or any other scalar field, providing both geometric form and quantitative information in a single view. Compared to contour plots—which flatten the data to a plan view—and wireframe plots—which emphasize structure through linework, surface plots deliver a more “realistic” depiction of the 3D shape.</p>
<p>Surface plots are especially useful in groundwater transport studies when communicating results to non-specialist audiences or when subtle gradients and localized anomalies are important to detect. The combination of form (surface shape) and chromatic variation (color mapping) makes it easier to identify patterns such as plume centers, zones of high dispersion, or depressions in hydraulic head surfaces. They are also well suited for creating publication-quality figures or interactive 3D visualizations that allow rotation and zooming, offering an intuitive understanding of how the dataset behaves in space. In many workflows, surface plots complement contour and wireframe plots: the contour plot provides precise quantitative reference lines, the wireframe shows the skeletal structure, and the surface plot brings the data to life with continuous, visually compelling representation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_wireframe_from_xyz.py  (now supports filled surfaces)</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Plot a 3D wireframe OR a filled, colored surface from an XYZ file.</span>
<span class="c1">#   Uses gridding + interpolation; supports vertical exaggeration.</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa: F401</span>

<span class="k">def</span> <span class="nf">plot_wireframe_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>          <span class="c1"># &#39;linear&#39;|&#39;cubic&#39;|&#39;nearest&#39;</span>
    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>           <span class="c1"># None|&#39;nearest&#39;</span>
    <span class="n">rstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">view_elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">view_azim</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Wireframe (Interpolated Grid)&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># --- new args for filled surface ---</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>             <span class="c1"># &lt;&lt; set True to color by Z</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D wireframe (default) or filled colored surface (filled=True)</span>
<span class="sd">    from an XYZ text file using gridding + interpolation.</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

    <span class="c1"># --- Grid ---</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ny</span><span class="p">)</span>
    <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

    <span class="c1"># --- Interpolate ---</span>
    <span class="n">Zg</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">Zg</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># try to find a parent fig (for colorbar)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="n">mappable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
            <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span>
            <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span>
            <span class="n">rstride</span><span class="o">=</span><span class="n">rstride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">cstride</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">edgecolor</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">filled</span> <span class="k">else</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Wireframe&#39;</span><span class="p">,</span> <span class="s1">&#39;Filled Surface&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="n">vertical_exag</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filled</span> <span class="ow">and</span> <span class="n">add_colorbar</span> <span class="ow">and</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">ax</span>


<span class="c1"># Gridded, filled surface</span>
<span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_wireframe_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vertical_exag</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Filled Surface (Interpolated Grid)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c1ebb8f43a5e761f76ef48b474b9be147f0e9dbc9f986bfb96e5eb167da5c0b4.png" src="../../_images/c1ebb8f43a5e761f76ef48b474b9be147f0e9dbc9f986bfb96e5eb167da5c0b4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_triangulated_surface_from_xyz.py (now supports filled)</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Plot a 3D triangulated surface as wire-like edges OR filled, </span>
<span class="c1">#   colored by Z directly from scattered points (no gridding).</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">mtri</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa: F401</span>

<span class="k">def</span> <span class="nf">plot_triangulated_surface_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>          <span class="c1"># unused; kept for signature parity</span>
    <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rstride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">view_elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">view_azim</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Triangulated Surface (Wireframe Style)&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># --- new args for filled surface ---</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>             <span class="c1"># &lt;&lt; set True to color by Z</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D triangulated surface from an XYZ text file.</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">tri</span> <span class="o">=</span> <span class="n">mtri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="n">mappable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="c1"># Filled colored surface</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span>
            <span class="n">tri</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Wire-like surface (thin edges, translucent faces)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span>
            <span class="n">tri</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
            <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">filled</span> <span class="k">else</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Wireframe Style&#39;</span><span class="p">,</span> <span class="s1">&#39;Filled Surface&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">z</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">*</span> <span class="n">vertical_exag</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filled</span> <span class="ow">and</span> <span class="n">add_colorbar</span> <span class="ow">and</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tri</span><span class="p">,</span> <span class="n">ax</span>

<span class="c1"># Triangulated, filled surface</span>
<span class="n">tri</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_triangulated_surface_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vertical_exag</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Filled Triangulated Surface&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1bb04b189623a1270ac5e772fdf8af5581dd9d42bbc0341013f4bf26c8c20b89.png" src="../../_images/1bb04b189623a1270ac5e772fdf8af5581dd9d42bbc0341013f4bf26c8c20b89.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f
<span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_wireframe_from_xyz.py  (now with plan-view contour base)</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Plot a 3D wireframe OR a filled, colored surface from an XYZ file.</span>
<span class="c1">#   Adds an optional plan-view filled contour projected onto a base Z.</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa: F401</span>

<span class="k">def</span> <span class="nf">plot_wireframe_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
    <span class="n">rstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">view_elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">view_azim</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Wireframe (Interpolated Grid)&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Filled surface options</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># NEW: plan-view base contour options</span>
    <span class="n">base_projection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>            <span class="c1"># &lt;&lt; enable/disable base “shadow”</span>
    <span class="n">base_z</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span>                    <span class="c1"># &#39;min&#39; | &#39;max&#39; | float (e.g., 0.0)</span>
    <span class="n">base_levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>                  <span class="c1"># int or list of levels</span>
    <span class="n">base_cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                  <span class="c1"># defaults to cmap if None</span>
    <span class="n">base_alpha</span><span class="o">=</span><span class="mf">0.9</span>                   <span class="c1"># transparency for base</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D wireframe (default) or filled colored surface (filled=True)</span>
<span class="sd">    with optional plan-view filled contour projected to a base plane.</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>

    <span class="c1"># --- Grid ---</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">nx</span><span class="p">)</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ny</span><span class="p">)</span>
    <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

    <span class="c1"># --- Interpolate ---</span>
    <span class="n">Zg</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">Zg</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="c1"># Plan-view base projection (before surface so it sits “under” visually)</span>
    <span class="k">if</span> <span class="n">base_projection</span><span class="p">:</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_z</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_z</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">base_z</span><span class="p">))</span>
        <span class="n">mappable_base</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
            <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span>
            <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">z0</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">base_levels</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="p">(</span><span class="n">base_cmap</span> <span class="ow">or</span> <span class="n">cmap</span><span class="p">),</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">base_alpha</span>
        <span class="p">)</span>

    <span class="n">mappable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span>
            <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span>
            <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span>
            <span class="n">rstride</span><span class="o">=</span><span class="n">rstride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">cstride</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">edgecolor</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">filled</span> <span class="k">else</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Wireframe&#39;</span><span class="p">,</span> <span class="s1">&#39;Filled Surface&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="c1"># Set axis limits to make sure the base plane is visible</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">yi</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">base_projection</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">z0</span><span class="p">))</span>

    <span class="c1"># Aspect &amp; camera</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">*</span> <span class="n">vertical_exag</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filled</span> <span class="ow">and</span> <span class="n">add_colorbar</span> <span class="ow">and</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gridded, filled + base at Zmin</span>
<span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_wireframe_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> 
    <span class="n">base_projection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base_z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">base_levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Filled Surface + Plan-View Shadow (Grid)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/01196efbab3dd9ae83e2009618347b46fd247556ac6ee7942a54f4ce0020c662.png" src="../../_images/01196efbab3dd9ae83e2009618347b46fd247556ac6ee7942a54f4ce0020c662.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_triangulated_surface_from_xyz.py (with plan-view base)</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Plot a 3D triangulated surface; optional plan-view filled contour</span>
<span class="c1">#   projected to a base Z for a “shadow” map under the 3D surface.</span>
<span class="c1"># =====================================================================</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="k">as</span> <span class="nn">mtri</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa: F401</span>

<span class="k">def</span> <span class="nf">plot_triangulated_surface_from_xyz</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rstride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
    <span class="n">view_elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">view_azim</span><span class="o">=-</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">show_points</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">point_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Triangulated Surface (Wireframe Style)&#39;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Filled surface options</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># NEW: plan-view base contour options</span>
    <span class="n">base_projection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">base_z</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span>
    <span class="n">base_levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">base_cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">base_alpha</span><span class="o">=</span><span class="mf">0.9</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a 3D triangulated surface with optional plan-view filled contour.</span>

<span class="sd">    Provenance</span>
<span class="sd">    ----------</span>
<span class="sd">    Script by Sensei + OpenAI (2025-08-12)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- Load ---</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;X-Easting&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Y-Northing&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Z-Elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">tri</span> <span class="o">=</span> <span class="n">mtri</span><span class="o">.</span><span class="n">Triangulation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># --- Plot ---</span>
    <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">created_fig</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="c1"># Plan-view base projection</span>
    <span class="k">if</span> <span class="n">base_projection</span><span class="p">:</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_z</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="k">if</span> <span class="n">base_z</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">base_z</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span>
            <span class="n">tri</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
            <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">z0</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">base_levels</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="p">(</span><span class="n">base_cmap</span> <span class="ow">or</span> <span class="n">cmap</span><span class="p">),</span>
            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">base_alpha</span>
        <span class="p">)</span>

    <span class="n">mappable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">filled</span><span class="p">:</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span>
            <span class="n">tri</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span>
            <span class="n">tri</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
            <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">show_points</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">point_size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">point_color</span><span class="p">,</span> <span class="n">depthshade</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">filled</span> <span class="k">else</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Wireframe Style&#39;</span><span class="p">,</span> <span class="s1">&#39;Filled Surface&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate (Easting, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate (Northing, ft)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="c1"># Limits so the base plane is visible</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">base_projection</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">z0</span><span class="p">))</span>

    <span class="c1"># Aspect &amp; camera</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">*</span> <span class="n">vertical_exag</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_elev</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_azim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filled</span> <span class="ow">and</span> <span class="n">add_colorbar</span> <span class="ow">and</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">mappable</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elevation (ft)&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">created_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">tri</span><span class="p">,</span> <span class="n">ax</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Triangulated, filled + base at Z=0.0 (constant)</span>
<span class="n">tri</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_triangulated_surface_from_xyz</span><span class="p">(</span>
    <span class="s1">&#39;ARS-W1-XYZ.txt&#39;</span><span class="p">,</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> 
    <span class="n">base_projection</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">base_z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">base_levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">vertical_exag</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Filled Surface + Plan-View Shadow (Triangulation)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a886ee3292d3a91bcec2c0dcf26aa559a1be05de8c4b9c53744d2c3f433de5a0.png" src="../../_images/a886ee3292d3a91bcec2c0dcf26aa559a1be05de8c4b9c53744d2c3f433de5a0.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="block-models-from-interval-data-experimental">
<h1>5.4 Block models from interval data (Experimental)<a class="headerlink" href="#block-models-from-interval-data-experimental" title="Link to this heading">#</a></h1>
<p>A block model is a three-dimensional representation of the subsurface, where the domain is divided into discrete volumetric elements—often rectangular prisms—each assigned a geologic or material property. In its simplest form, a block model can be conceptual, built from interpreted lithologic intervals such as clay, silt, or sand layers between known depths at given <span class="math notranslate nohighlight">\(x,y\)</span> locations. By arranging these intervals in space, we create a visual “stack” of blocks that collectively portray the spatial distribution of materials beneath the ground surface. This approach is common in mining geology, hydrogeology, and geotechnical engineering because it provides a tangible, spatially explicit view of data that is otherwise confined to logs or tables.</p>
<p>Block models are especially useful for visualizing heterogeneity. Many subsurface properties—such as hydraulic conductivity, porosity, or contaminant concentration—vary significantly across short distances. By representing these variations as discrete blocks, we can quickly identify patterns like channel deposits, impermeable barriers, or preferential flow paths. These visualizations help bridge the gap between raw borehole data and the conceptual models used for numerical simulation. While the real subsurface is continuous and complex, the discretized nature of block models makes them a natural stepping stone toward finite-difference or finite-element grids used in transport modeling.</p>
<p>In the context of this chapter, the goal is to start with conceptual 3D block models from interval data—simple prisms defined by-
<span class="math notranslate nohighlight">\(x,y,z_{low},z_{high},\text{attribute}\)</span>—and then progress to PyVista-based slicing and interactive exploration. The initial plots help confirm that the intervals are assembled correctly and that the model conveys the intended conceptual geometry. PyVista can then be used to slice through the model along arbitrary planes, extract layers, or rotate the scene interactively, providing both qualitative understanding and quantitative checks. This combination of conceptual block construction and interactive slicing makes block models a powerful tool for both teaching and early-stage project analysis.</p>
<p>Unlike contour, wireframe, or surface plots—which represent continuous surfaces such as water table elevations or concentration isosurfaces—block models focus on volumetric representation. They do not simply depict the “skin” of a dataset; instead, they portray the internal structure of the subsurface in discrete chunks. This makes them well suited for visualizing properties that vary with both depth and lateral position, such as lithologic units or aquifer zones with different hydraulic conductivities. In groundwater transport studies, block models complement surface-based plots by revealing the three-dimensional arrangement of materials that control how water and solutes move underground.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The examples below use a lot of resources, expect slow response time and frequent system failures.  The forced reset below is an attempt to release resources while experimenting with the scripts</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">reset</span> -f 
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="c1"># ================================================================</span>
<span class="c1"># Build categorical facies volume (sand/silt/clay) from irregular</span>
<span class="c1"># horizon points, then render as a 3D block model in PyVista.</span>
<span class="c1"># Files: toy_surfaces_points.csv (horizon points)</span>
<span class="c1"># Author(s): Sensei + OpenAI — 2025-08-12</span>
<span class="c1"># ================================================================</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>

<span class="c1"># --- Prototype functions</span>

<span class="k">def</span> <span class="nf">exaggerate_image_z</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ve</span><span class="o">=</span><span class="mf">20.0</span><span class="p">):</span>
    <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">spacing</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">ve</span><span class="p">)</span>   <span class="c1"># stretch Z in world coordinates</span>
    <span class="k">return</span> <span class="n">grid</span>

<span class="c1"># --- Load irregular horizon points ---</span>
<span class="n">surfaces</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;toy_surfaces_points.csv&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">surfaces</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">z_top</span>       <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="s2">&quot;z_top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">z_base_clay</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="s2">&quot;z_base_clay&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">z_base_silt</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="s2">&quot;z_base_silt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">z_bottom</span>    <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="s2">&quot;z_bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># --- Define target uniform grid in XY and Z ---</span>
<span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">50</span>            <span class="c1"># tweak for resolution/performance</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
<span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

<span class="c1"># Interpolate each horizon to the XY grid</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">_interp</span><span class="p">(</span><span class="n">surface_vals</span><span class="p">):</span>
    <span class="n">Zg</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">surface_vals</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
    <span class="c1"># fill extrapolation holes at hull edges</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">Znn</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">surface_vals</span><span class="p">,</span> <span class="p">(</span><span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
        <span class="n">Zg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Znn</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Zg</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">Zg</span>

<span class="n">Ztop_g</span>   <span class="o">=</span> <span class="n">_interp</span><span class="p">(</span><span class="n">z_top</span><span class="p">)</span>
<span class="n">Zbc_g</span>    <span class="o">=</span> <span class="n">_interp</span><span class="p">(</span><span class="n">z_base_clay</span><span class="p">)</span>
<span class="n">Zbs_g</span>    <span class="o">=</span> <span class="n">_interp</span><span class="p">(</span><span class="n">z_base_silt</span><span class="p">)</span>
<span class="n">Zbot_g</span>   <span class="o">=</span> <span class="n">_interp</span><span class="p">(</span><span class="n">z_bottom</span><span class="p">)</span>

<span class="c1"># Vertical sampling</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Zbot_g</span><span class="p">))</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Ztop_g</span><span class="p">))</span>
<span class="n">zk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">nz</span><span class="p">)</span>    <span class="c1"># elevation levels of voxel centers</span>

<span class="c1"># --- Classify facies (0=outside/void, 1=sand, 2=silt, 3=clay) ---</span>
<span class="c1"># Broadcast 2D horizons (ny,nx) against Z (1,1,nz)</span>
<span class="n">Z3</span> <span class="o">=</span> <span class="n">zk</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Ztop</span>   <span class="o">=</span> <span class="n">Ztop_g</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">Zbc</span>    <span class="o">=</span> <span class="n">Zbc_g</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">Zbs</span>    <span class="o">=</span> <span class="n">Zbs_g</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">Zbot</span>   <span class="o">=</span> <span class="n">Zbot_g</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

<span class="n">facies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nz</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<span class="c1"># clay: between base_clay and top</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z3</span> <span class="o">&lt;=</span> <span class="n">Ztop</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Z3</span> <span class="o">&gt;</span> <span class="n">Zbc</span><span class="p">)</span>
<span class="n">facies</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="c1"># silt: between base_silt and base_clay</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z3</span> <span class="o">&lt;=</span> <span class="n">Zbc</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Z3</span> <span class="o">&gt;</span> <span class="n">Zbs</span><span class="p">)</span>
<span class="n">facies</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># sand: between bottom and base_silt</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z3</span> <span class="o">&lt;=</span> <span class="n">Zbs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Z3</span> <span class="o">&gt;=</span> <span class="n">Zbot</span><span class="p">)</span>
<span class="n">facies</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># --- Build PyVista uniform grid (ImageData) ---</span>
<span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dz</span> <span class="o">=</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">()</span>
<span class="n">grid</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nz</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>

<span class="c1"># VTK expects Fortran order for raveling volumetric scalars</span>
<span class="n">grid</span><span class="p">[</span><span class="s2">&quot;facies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">facies</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

<span class="c1"># --- Plot ---</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">vertical_stretch</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">exaggerate_image_z</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">ve</span><span class="o">=</span><span class="n">vertical_stretch</span><span class="p">)</span>

<span class="c1">#actor = p.add_mesh(grid.threshold([0.5, 3.5], scalars=&quot;facies&quot;),show_scalar_bar=False)</span>
<span class="c1">#actor.SetScale(1.0, 1.0, vertical_stretch)   # x, y, z scales</span>

<span class="c1"># Show each category with its own color &amp; legend</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;khaki&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;indigo&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;indianred&quot;</span><span class="p">}</span>  <span class="c1"># sand, silt, clay</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;sand&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;silt&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;clay&quot;</span><span class="p">}</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_legend</span><span class="p">([[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
              <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
              <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="p">]]],</span>
             <span class="n">bcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Select voxels whose facies is &quot;code&quot; (half-open bin around the code)</span>
    <span class="n">band</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">threshold</span><span class="p">([</span><span class="n">code</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">code</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;facies&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">band</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">code</span><span class="p">],</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_axes</span><span class="p">()</span>
<span class="c1">#p.show_bounds(grid=&quot;front&quot;, location=&quot;outer&quot;, ticks=&quot;outside&quot;, xlabel=&quot;X&quot;, ylabel=&quot;Y&quot;, zlabel=&quot;Z (elev)&quot;)</span>
<span class="n">p</span><span class="o">.</span><span class="n">show_bounds</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="s2">&quot;front&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
              <span class="n">xtitle</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">ytitle</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">ztitle</span><span class="o">=</span><span class="s2">&quot;Z (x&quot;</span> <span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">vertical_stretch</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
<span class="c1"># For notebooks: p.show(jupyter_backend=&#39;static&#39;)</span>
<span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">jupyter_backend</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Yellow">2025-08-26 23:12:00.530 (   1.805s) [    7E1D05F841C0]vtkXOpenGLRenderWindow.:1458  WARN| bad X server connection. DISPLAY=</span>
</pre></div>
</div>
<img alt="../../_images/0cf0b61840567e0fee8a0f3540ed8716c3fbfefcc9d170c991d6023d923acefd.png" src="../../_images/0cf0b61840567e0fee8a0f3540ed8716c3fbfefcc9d170c991d6023d923acefd.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="axial-slices-through-3d-block-models">
<h1>5.5 Axial slices through 3D block models<a class="headerlink" href="#axial-slices-through-3d-block-models" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># =====================================================================</span>
<span class="c1"># Script: plot_facies_slice.py</span>
<span class="c1"># Author(s): Sensei + OpenAI</span>
<span class="c1"># Date: 2025-08-12</span>
<span class="c1"># Description:</span>
<span class="c1">#   Vertical slice through a categorical facies volume (pyvista.ImageData)</span>
<span class="c1">#   at a constant X (YZ plane) or constant Y (XZ plane). Supports thin</span>
<span class="c1">#   plane or thick slab, vertical exaggeration, and compact legend.</span>
<span class="c1"># =====================================================================</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>

<span class="k">def</span> <span class="nf">exaggerate_image_z</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">,</span> <span class="n">ve</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale Z spacing of an ImageData grid (in-place).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ve</span> <span class="ow">and</span> <span class="n">ve</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">spacing</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sz</span> <span class="o">*</span> <span class="n">ve</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grid</span>

<span class="k">def</span> <span class="nf">plot_facies_slice</span><span class="p">(</span>
    <span class="n">grid</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">ImageData</span><span class="p">,</span>
    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>            <span class="c1"># &#39;x&#39; =&gt; YZ slice at X=value; &#39;y&#39; =&gt; XZ slice at Y=value</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>         <span class="c1"># the world coordinate along the chosen axis</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">thick</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>                 <span class="c1"># 0 =&gt; exact plane; &gt;0 =&gt; slab thickness</span>
    <span class="n">vertical_exag</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>         <span class="c1"># multiplies Z spacing (dataset-level)</span>
    <span class="n">colors</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                <span class="c1"># {1:&#39;khaki&#39;,2:&#39;lightgray&#39;,3:&#39;indianred&#39;}</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>                <span class="c1"># {1:&#39;sand&#39;,2:&#39;silt&#39;,3:&#39;clay&#39;}</span>
    <span class="n">legend_size</span><span class="o">=</span><span class="p">(</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">),</span>
    <span class="n">legend_loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
    <span class="n">show_scalar_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">jupyter_backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># e.g., &#39;static&#39; or &#39;trame&#39;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render a vertical slice through a facies volume at X=value or Y=value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    grid : pv.ImageData</span>
<span class="sd">        Uniform grid with integer &#39;facies&#39; codes (1=sand, 2=silt, 3=clay).</span>
<span class="sd">    axis : {&#39;x&#39;,&#39;y&#39;}</span>
<span class="sd">        Which coordinate to hold constant: &#39;x&#39; -&gt; YZ slice; &#39;y&#39; -&gt; XZ slice.</span>
<span class="sd">    value : float</span>
<span class="sd">        World-coordinate position for the slice.</span>
<span class="sd">    thick : float, optional</span>
<span class="sd">        If &gt; 0, extract a slab of that thickness centered at &#39;value&#39;.</span>
<span class="sd">    vertical_exag : float, optional</span>
<span class="sd">        Multiply Z spacing at dataset level (axes/bounds remain honest).</span>
<span class="sd">    colors, labels : dict, optional</span>
<span class="sd">        Facies color and label maps.</span>
<span class="sd">    legend_size : (float,float), optional</span>
<span class="sd">        Legend size as fraction of viewport (width, height).</span>
<span class="sd">    legend_loc : str, optional</span>
<span class="sd">        Legend anchor location.</span>
<span class="sd">    show_scalar_bar : bool, optional</span>
<span class="sd">        Show scalar bar (usually False for categorical classes).</span>
<span class="sd">    jupyter_backend : str or None</span>
<span class="sd">        Force a Jupyter backend.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    geom : pyvista.DataSet</span>
<span class="sd">        Slice geometry (plane or slab).</span>
<span class="sd">    p : pv.Plotter</span>
<span class="sd">        Plotter used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">jupyter_backend</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pv</span><span class="o">.</span><span class="n">set_jupyter_backend</span><span class="p">(</span><span class="n">jupyter_backend</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;khaki&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;indianred&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;sand&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;silt&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;clay&quot;</span><span class="p">}</span>

    <span class="c1"># Work on a shallow copy; exaggerate Z spacing</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">exaggerate_image_z</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vertical_exag</span><span class="p">)</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">bounds</span>

    <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;X=value (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) outside bounds [</span><span class="si">{</span><span class="n">xmin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">xmax</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
        <span class="c1"># Build geometry</span>
        <span class="k">if</span> <span class="n">thick</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">half</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">thick</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;-x&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">half</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">))</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;+x&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">half</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">ymin</span><span class="o">+</span><span class="n">ymax</span><span class="p">),</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">zmin</span><span class="o">+</span><span class="n">zmax</span><span class="p">)))</span>
        <span class="n">view_fn</span> <span class="o">=</span> <span class="s1">&#39;view_yz&#39;</span>
        <span class="n">fixed_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;X = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">free1</span><span class="p">,</span> <span class="n">free2</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Z (×</span><span class="si">{</span><span class="n">vertical_exag</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">elif</span> <span class="n">axis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Y=value (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) outside bounds [</span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="k">if</span> <span class="n">thick</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">half</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">thick</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;-y&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">value</span> <span class="o">-</span> <span class="n">half</span><span class="p">,</span> <span class="n">zmin</span><span class="p">))</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;+y&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">value</span> <span class="o">+</span> <span class="n">half</span><span class="p">,</span> <span class="n">zmin</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">normal</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xmin</span><span class="o">+</span><span class="n">xmax</span><span class="p">),</span> <span class="n">value</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">zmin</span><span class="o">+</span><span class="n">zmax</span><span class="p">)))</span>
        <span class="n">view_fn</span> <span class="o">=</span> <span class="s1">&#39;view_xz&#39;</span>
        <span class="n">fixed_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Y = </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">free1</span><span class="p">,</span> <span class="n">free2</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Z (×</span><span class="si">{</span><span class="n">vertical_exag</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;axis must be &#39;x&#39; or &#39;y&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Plot per-facies to keep categorical colors and add a compact legend</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
    <span class="n">added</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">geom</span><span class="o">.</span><span class="n">threshold</span><span class="p">([</span><span class="n">code</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">code</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;facies&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">n_cells</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">code</span><span class="p">],</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="n">show_scalar_bar</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>
            <span class="n">added</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">added</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Slice contains no cells with facies 1, 2, or 3 at the chosen location.&quot;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">add_legend</span><span class="p">([[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="p">]]],</span>
                 <span class="n">size</span><span class="o">=</span><span class="n">legend_size</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">bcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Orient camera perpendicular to the slice; parallel projection → 2D feel</span>
    <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">view_fn</span><span class="p">)()</span>            <span class="c1"># p.view_yz() or p.view_xz()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">enable_parallel_projection</span><span class="p">()</span>

    <span class="c1"># Axis titles: show the fixed coordinate and label the varying axes</span>
    <span class="n">p</span><span class="o">.</span><span class="n">show_bounds</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="s2">&quot;front&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="s2">&quot;outside&quot;</span><span class="p">,</span>
                  <span class="n">xtitle</span><span class="o">=</span><span class="n">fixed_title</span> <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="s1">&#39;x&#39;</span> <span class="k">else</span> <span class="n">free1</span><span class="p">,</span>
                  <span class="n">ytitle</span><span class="o">=</span><span class="n">free1</span> <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="s1">&#39;x&#39;</span> <span class="k">else</span> <span class="n">fixed_title</span><span class="p">,</span>
                  <span class="n">ztitle</span><span class="o">=</span><span class="n">free2</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">geom</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YZ slice at X = 600 (your earlier case)</span>
<span class="n">plot_facies_slice</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">600.0</span><span class="p">,</span> <span class="n">thick</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">jupyter_backend</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/41a22ef69fcaba3741628b7ffa9ba2e91cf2952adb4861ae3a4303d10bafcfd4.png" src="../../_images/41a22ef69fcaba3741628b7ffa9ba2e91cf2952adb4861ae3a4303d10bafcfd4.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(PolyData (0x7e1cc080e920)
   N Cells:    4361
   N Points:   4500
   N Strips:   0
   X Bounds:   6.000e+02, 6.000e+02
   Y Bounds:   4.669e-01, 8.995e+02
   Z Bounds:   3.318e+01, 2.481e+03
   N Arrays:   1,
 &lt;pyvista.plotting.plotter.Plotter at 0x7e1cadfdc2e0&gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># XZ slice at Y = 450 with a 10-unit slab</span>
<span class="n">plot_facies_slice</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">450.0</span><span class="p">,</span> <span class="n">thick</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vertical_exag</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">jupyter_backend</span><span class="o">=</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d9168ce297429fe365af18accc137073939b25ca2971d078d0dedc9aae110286.png" src="../../_images/d9168ce297429fe365af18accc137073939b25ca2971d078d0dedc9aae110286.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(PolyData (0x7e1cc0cd2da0)
   N Cells:    5831
   N Points:   6000
   N Strips:   0
   X Bounds:   6.516e+00, 1.199e+03
   Y Bounds:   4.500e+02, 4.500e+02
   Z Bounds:   3.318e+01, 2.481e+03
   N Arrays:   1,
 &lt;pyvista.plotting.plotter.Plotter at 0x7e1cc06b50c0&gt;)
</pre></div>
</div>
</div>
</div>
<section id="exercise-s">
<h2>Exercise(s)<a class="headerlink" href="#exercise-s" title="Link to this heading">#</a></h2>
</section>
<section id="section-end">
<h2>Section End<a class="headerlink" href="#section-end" title="Link to this heading">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python-my-env",
            path: "./chapters/03site.mapping.tools"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python-my-env'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../01fundamentals/01fundamentals.practice.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">3. Fundamentals (Practice)</p>
      </div>
    </a>
    <a class="right-next"
       href="../03site.characterization/site.characterization.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">6. Site Characterization</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">5. Site Mapping Tools</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#readings">Readings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#video-s">Video(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#approach">Approach</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-we-will-build">What we will build</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-expectations">Data expectations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#roadmap">Roadmap</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#contour-plots">5.1 Contour Plots</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#wireframe-plots">5.2 Wireframe Plots</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#surface-plots">5.3 Surface Plots</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#block-models-from-interval-data-experimental">5.4 Block models from interval data (Experimental)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#axial-slices-through-3d-block-models">5.5 Axial slices through 3D block models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-s">Exercise(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#section-end">Section End</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Theodore G. Cleveland, PhD
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>